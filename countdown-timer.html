<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countdown-Timer</title>
</head>
<body>
    <label for="event-name">Event Name</label><br>
    <input type="text" name="event-name" id="event-name" /><br>
    <p id="event-name-error" style="color: red;"></p>

    <label for="event-date" id="event-date-label">Event Date</label><br>
    <input type="date" name="event-date" id="event-date" /><br>
    <p id="event-date-error" style="color: red;"></p>


    <!-- <label for="event-time-check" id="event-time-check">Time?</label> -->
    <label for="event-time" id="event-time-label">Event Time</label><br>
    <!-- <input type="checkbox" id="time-checkbox" name="time-checkbox" onclick="handleTimeFIeld()"><br> -->
    <input type="time" name="event-time" id="event-time"/><br>
    <input type="submit" value="Set Timer" onclick="validateInputs()"/>
    <input type="button" value="clear stored timers" onclick="clearStorage()"/>

    <p id="timer-name"></p>
    <p id="timer-date"></p>
    <p id="timer-time"></p>
    <p id="countdown"></p>

</body>
    <script>
        var dates = {};

        function cb (years, months, weeks, days, hours, minutes, seconds) {
            console.log(years, ' years,', months, ' months,', weeks, ' weeks,', days, ' days,', hours, ' hours,', minutes, ' + minutes,', seconds, ' seconds',);
        };

        var threeYrInMils = 94670856000;

        function createTimer(name, date) {
            var foo = setInterval(() => workOutTimeLeft(name, date), 1000)
        }

        function workOutTimeLeft(name, date) {
            let now = Date.now()
            let countdownString;
            let years, months, weeks, days, hours, minutes, seconds;
            let milisecondsUntil = date - now;
            let timeLeft

            if (Math.floor(milisecondsUntil / 29030400000) > 0) {
                years = Math.floor(milisecondsUntil / 29030400000)
                timeLeft = milisecondsUntil % 29030400000;
                countdownString = years + ' years,'
            }
            
            if (!timeLeft) timeLeft = milisecondsUntil;

            if ((Math.floor(timeLeft / 2419200000)) > 0) {
                months = Math.floor(timeLeft / 2419200000) 
                timeLeft = timeLeft % 2419200000;
                countdownString += months + ' months,'

            }

            if (!timeLeft) timeLeft = milisecondsUntil;

            if ((Math.floor(timeLeft / 604800000)) > 0) {
                weeks = Math.floor(timeLeft / 604800000) 
                timeLeft = timeLeft % 604800000;
                countdownString += weeks + ' weeks,'

            }

            if (!timeLeft) timeLeft = milisecondsUntil;

            if ((Math.floor(timeLeft / 86400000)) > 0) {
                days = Math.floor(timeLeft / 86400000) 
                timeLeft = timeLeft % 86400000;
                countdownString += days + ' days,'

            }

            if (!timeLeft) timeLeft = milisecondsUntil;

            if ((Math.floor(timeLeft / 3600000)) > 0) {
                hours = Math.floor(timeLeft / 3600000) 
                timeLeft = timeLeft % 3600000;
                countdownString += hours + ' hours,'

            }

            if (!timeLeft) timeLeft = milisecondsUntil;

            if ((Math.floor(timeLeft / 60000)) > 0) {
                minutes = Math.floor(timeLeft / 60000) 
                timeLeft = timeLeft % 60000;
                countdownString += minutes + ' minutes,'

            }

            if (!timeLeft) timeLeft = milisecondsUntil;

            if ((Math.floor(timeLeft / 1000)) > 0) {
                seconds = Math.floor(timeLeft / 1000) 
                timeLeft = timeLeft % 1000;
                countdownString += seconds + ' seconds,'

            }

            document.getElementById("countdown").innerHTML = countdownString;
            console.log(years, months, weeks, days, hours, minutes, seconds);


            // setInterval(() => cb(years, months, weeks, days, hours, minutes, seconds), 1000);
        // window.onload = function() {
        //     setInterval(cb, 1000)
        // }
        // var interval;
        // TODO
        // use clearInterval and setInterval for the countdown
        // use localStorage to set timers
        // format milisecond for eventDate into actual date
        //
        // interval = window.setInterval(console.log('a second has passed'), 1000);
            console.log(name, date, 'timothy')

        };

        function validateInputs() {
            var eventName = document.getElementById("event-name").value;
            var eventTime = document.getElementById("event-time").value || "00:00";
            var eventDate = Date.parse(document.getElementById("event-date").value + 'T' + eventTime);
            var nameValid = false;
            var dateValid = true;

                if (!eventName) {
                    nameValid = false;
                    document.getElementById("event-name-error").innerHTML = 'You must provide an event name';
                } else {
                    nameValid = true;
                    document.getElementById("event-name-error").innerHTML = '';
                }

                if (!eventDate) {
                    dateValid = false;
                    document.getElementById("event-date-error").innerHTML = 'You must provide an event date';
                } else {
                    if ((eventDate - Date.now()) < 0) {
                        dateValid = false;
                        document.getElementById("event-date-error").innerHTML = 'You cannot enter a date in the past';
                    } else if (eventDate > (Date.now() + threeYrInMils)) {
                        dateValid = false;
                        document.getElementById("event-date-error").innerHTML = 'You cannot enter a date more than 3 years in the future';
                    } else {
                        dateValid = true;
                        document.getElementById("event-date-error").innerHTML = '';
                    }
                }
            if (nameValid, dateValid) {
                dates.eventName = eventDate;
                createTimer(eventName, eventDate);
            }  
        }
        // console.log(JSON.parse(localStorage.yourObject) || {});
        console.log(localStorage);
        // var obj = JSON.parse(localStorage.yourObject || {});
        // console.log(obj, 'here is obj');
        function clearStorage() {
            delete localStorage.yourObject;
        }

        function parseDate () {
            // need to show error/warning message for when the date is overflow - more than 999 days?
            // last 2 digits of the below is miliseconds, trim that, 3rd and 4th last is seconds, always 00
            console.log(Date.parse(document.getElementById("event-date").value + 'T' + (document.getElementById("event-time").value || '00:00')));
            var foo = Date.parse(document.getElementById("event-date").value);
            console.log(foo);
            // console.log(foo.getMinutes());
        }
    </script>
</html>